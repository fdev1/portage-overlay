diff --git a/Makefile.am b/Makefile.am
index 5f1adc8..a889151 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -5,17 +5,11 @@
 # Copyright (C) 2005 Rémi Turboult <r3mi@users.sourceforge.net>
 #
 
-ACLOCAL_AMFLAGS = -I m4 -I gl/m4 -I libupnp/m4
+ACLOCAL_AMFLAGS = -I m4 -I gl/m4
 
 CLEANFILES	= IUpnpErrFile.txt IUpnpInfoFile.txt
 
 SUBDIRS 	= gl
-if INTERNAL_TALLOC
-    SUBDIRS 	+= talloc 
-endif
-if INTERNAL_LIBUPNP
-    SUBDIRS	+= libupnp
-endif
 SUBDIRS 	+= djmount
 
 EXTRA_DIST	= search_help.txt
diff --git a/Makefile.in b/Makefile.in
index c200de8..c125ac1 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -42,28 +42,19 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
-@INTERNAL_TALLOC_TRUE@am__append_1 = talloc 
-@INTERNAL_LIBUPNP_TRUE@am__append_2 = libupnp
 DIST_COMMON = README $(am__configure_deps) $(srcdir)/Makefile.am \
 	$(srcdir)/Makefile.in $(srcdir)/config.h.in \
 	$(top_srcdir)/configure AUTHORS COPYING ChangeLog INSTALL NEWS \
-	THANKS TODO libupnp/config.aux/compile \
-	libupnp/config.aux/config.guess libupnp/config.aux/config.sub \
-	libupnp/config.aux/depcomp libupnp/config.aux/install-sh \
-	libupnp/config.aux/ltmain.sh libupnp/config.aux/missing
+	THANKS TODO
 subdir = .
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
-am__aclocal_m4_deps = $(top_srcdir)/libupnp/m4/acx_pthread.m4 \
-	$(top_srcdir)/libupnp/m4/ax_cflags_gcc_option.m4 \
-	$(top_srcdir)/libupnp/m4/ax_cflags_warn_all.m4 \
-	$(top_srcdir)/libupnp/m4/rt_bool_arg_enable.m4 \
+am__aclocal_m4_deps = \
 	$(top_srcdir)/gl/m4/error.m4 $(top_srcdir)/gl/m4/exitfail.m4 \
 	$(top_srcdir)/gl/m4/gnulib-comp.m4 $(top_srcdir)/gl/m4/hash.m4 \
 	$(top_srcdir)/gl/m4/minmax.m4 $(top_srcdir)/gl/m4/stdbool.m4 \
 	$(top_srcdir)/gl/m4/xalloc.m4 \
 	$(top_srcdir)/m4/rt_package_find.m4 \
 	$(top_srcdir)/m4/vl_lib_readline.m4 \
-	$(top_srcdir)/talloc/talloc/config.m4 \
 	$(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
@@ -82,7 +73,7 @@ RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
 	uninstall-recursive
 ETAGS = etags
 CTAGS = ctags
-DIST_SUBDIRS = gl talloc libupnp djmount
+DIST_SUBDIRS = gl djmount
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 distdir = $(PACKAGE)-$(VERSION)
 top_distdir = $(distdir)
@@ -223,7 +214,7 @@ sysconfdir = @sysconfdir@
 target_alias = @target_alias@
 ACLOCAL_AMFLAGS = -I m4 -I gl/m4 -I libupnp/m4
 CLEANFILES = IUpnpErrFile.txt IUpnpInfoFile.txt
-SUBDIRS = gl $(am__append_1) $(am__append_2) djmount
+SUBDIRS = gl djmount
 EXTRA_DIST = search_help.txt
 
 # 
@@ -421,7 +412,7 @@ distclean-tags:
 distdir: $(DISTFILES)
 	$(am__remove_distdir)
 	mkdir $(distdir)
-	$(mkdir_p) $(distdir)/gl/m4 $(distdir)/libupnp/config.aux $(distdir)/libupnp/m4 $(distdir)/m4 $(distdir)/talloc/talloc
+	$(mkdir_p) $(distdir)/gl/m4 $(distdir)/m4
 	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
 	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
 	list='$(DISTFILES)'; for file in $$list; do \
diff --git a/aclocal.m4 b/aclocal.m4
index 60526db..35337a0 100644
--- a/aclocal.m4
+++ b/aclocal.m4
@@ -8258,10 +8258,6 @@ AC_SUBST([am__tar])
 AC_SUBST([am__untar])
 ]) # _AM_PROG_TAR
 
-m4_include([libupnp/m4/acx_pthread.m4])
-m4_include([libupnp/m4/ax_cflags_gcc_option.m4])
-m4_include([libupnp/m4/ax_cflags_warn_all.m4])
-m4_include([libupnp/m4/rt_bool_arg_enable.m4])
 m4_include([gl/m4/error.m4])
 m4_include([gl/m4/exitfail.m4])
 m4_include([gl/m4/gnulib-comp.m4])
diff --git a/config.rpath b/config.rpath
new file mode 100644
index 0000000..68af4ad
--- /dev/null
+++ b/config.rpath
@@ -0,0 +1 @@
+# Needed by AM_ICONV
diff --git a/configure.ac b/configure.ac
index f1a5b10..a9bd91a 100644
--- a/configure.ac
+++ b/configure.ac
@@ -11,9 +11,6 @@
 AC_PREREQ(2.59)
 AC_INIT(djmount, 0.71, r3mi@users.sourceforge.net)
 
-# share auxiliary files with sub-configure in "libupnp"
-AC_CONFIG_AUX_DIR(libupnp/config.aux)
-AC_CONFIG_MACRO_DIR(libupnp/m4)
 AC_CONFIG_MACRO_DIR(m4)
 AC_CONFIG_MACRO_DIR(gl/m4)
 
@@ -32,14 +29,15 @@ AC_REVISION([$Revision: 266 $])
 # ----------------------
 #
 
-RT_BOOL_ARG_ENABLE([debug], [yes], [extra debugging code])
+AC_ARG_ENABLE([debug], [extra debugging code])
+AM_CONDITIONAL(ENABLE_DEBUG, test x"$enable_debug" = xyes)
 if test x"$enable_debug" = xyes; then
 	AC_DEFINE([DEBUG],1,[Define to 1 to compile debug code])
 fi
 
-
-RT_BOOL_ARG_ENABLE([charset], [yes], 
+AC_ARG_ENABLE([charset],
 	[charset conversion code and -o iocharset option (assume all UTF-8 when disabled)])
+AM_CONDITIONAL(ENABLE_CHARSET, test x"$enable_charset" = xyes)
 if test x"$enable_charset" = xyes; then
 	AC_DEFINE([HAVE_CHARSET],1,
 		  [Define to 1 to have charset conversion code])
@@ -53,7 +51,6 @@ fi
 AC_PROG_CC
 gl_EARLY
 
-# build static libraries by default (for bundled libupnp and talloc)
 AC_DISABLE_SHARED
 AC_PROG_LIBTOOL
 
@@ -76,9 +73,9 @@ if test x"$enable_debug" = xyes; then
 	:
 else
 	# add optimise for size
-	AX_CFLAGS_GCC_OPTION([-Os])
+	CFLAGS="$CFLAGS -Os"
 fi
-AX_CFLAGS_WARN_ALL
+CFLAGS="$CFLAGS -Wall"
 
 # Arrange for large-file support / large off_t
 # Define _FILE_OFFSET_BITS and _LARGE_FILES if necessary
@@ -134,13 +131,6 @@ gl_INIT
 # ------
 #
 
-AC_MSG_CHECKING([whether to use external talloc])
-AC_ARG_WITH([external-talloc], 
-	AS_HELP_STRING([--with-external-talloc],
-	[use external talloc library (not recommended) @<:@default = use internal bundled library@:>@]))
-
-if test x"$with_external_talloc" = xyes; then
-	AC_MSG_RESULT([yes])
 	# Find the library. This macro handles the TALLOC_CFLAGS and _LIBS,
 	# the --with-talloc-prefix arg, and pkg-config (if any).
 	RT_PACKAGE_FIND([talloc], [], [-ltalloc], [talloc >= 4.0], 
@@ -165,14 +155,7 @@ if test x"$with_external_talloc" = xyes; then
 ** use the internal bundled library. 
 ** Or $TALLOC_MSG_ERRORS
 	])])
-else
-	AC_MSG_RESULT([no (build bundled library)])
-	# Configure bundled talloc
-	m4_include(talloc/talloc/config.m4)
-	AC_SUBST(TALLOC_CFLAGS, '-I$(top_srcdir)/talloc/talloc')
-	AC_SUBST(TALLOC_LIBS, '-L$(top_builddir)/talloc -ltalloc')
-fi
-AM_CONDITIONAL(INTERNAL_TALLOC, test x"$with_external_talloc" != xyes)
+AM_CONDITIONAL(INTERNAL_TALLOC, false)
 
 
 #
@@ -210,6 +193,7 @@ ACX_PTHREAD([],[AC_MSG_ERROR([POSIX threads are required to build this program])
 # to the default compilation variables. This will also allow the tests below
 # (fuse, libupnp, ...) to pick these flags.
 LIBS="$PTHREAD_LIBS $LIBS"
+
 CFLAGS="$CFLAGS $PTHREAD_CFLAGS"
 CC="$PTHREAD_CC"
 
@@ -242,18 +226,6 @@ RT_PACKAGE_FIND([fuse], [-D_FILE_OFFSET_BITS=64], [-lfuse], [fuse >= 2.2],
 
 FUSE_CFLAGS="$FUSE_CFLAGS -DFUSE_USE_VERSION=22"
 
-
-#
-# libupnp 
-# -------
-#
-AC_MSG_CHECKING([whether to use external libupnp])
-AC_ARG_WITH([external-libupnp], 
-	AS_HELP_STRING([--with-external-libupnp],
-	[use external libupnp library (at least 1.3.1) @<:@default = use internal bundled library@:>@]))
-
-if test x"$with_external_libupnp" = xyes; then
-	AC_MSG_RESULT([yes])
 	# Find the library. This macro handles the LIBUPNP_CFLAGS and _LIBS,
 	# the --with-libupnp-prefix arg, and pkg-config (if any).
 	RT_PACKAGE_FIND([libupnp], [], [-lupnp -lthreadutil -lixml], 
@@ -278,34 +250,8 @@ if test x"$with_external_libupnp" = xyes; then
 ** use the internal bundled library. 
 ** Or $LIBUPNP_MSG_ERRORS
 	])])
-else
-	AC_MSG_RESULT([no (build bundled library)])
-	# Configure bundled libupnp :
-	# compile only necessary subset (static client libraries), 
-	# plus debug code if necessary.
-	# XXX there is no documented way to pass additional arguments 
-	# XXX to sub-configure, so we just hack the internal variable 
-	# XXX '$ac_configure_args' ...
-	mysave_ac_arg=$ac_configure_args
-	ac_configure_args="$ac_configure_args --enable-client --disable-device --disable-shared --enable-debug=$enable_debug"
-	AC_CONFIG_SUBDIRS(libupnp)
-	# Set compilation variables to the internal libupnp.
-	# The includes are a bit tricky to set because the uninstalled 
-	# include tree does not match the installed structure <upnp/*.h> :
-	# this is handled in djmount/Makefile.am
-	AC_SUBST(LIBUPNP_CFLAGS)
-	bd='$(top_builddir)/libupnp' # ! shall not expand $top_builddir !
-	AC_SUBST(LIBUPNP_LIBS, 
-	 ["-L$bd/upnp -lupnp -L$bd/threadutil -lthreadutil -L$bd/ixml -lixml"])
-	# Set specific libupnp debug flag (not provided by bundled library,
-	# but provided by external libupnp version >= 1.3)
-	if test x"$enable_debug" = xyes; then
-		AC_DEFINE([UPNP_HAVE_DEBUG],1,
-			  [Define to 1 if libupnp debug code enabled])
-	fi
-fi
-AM_CONDITIONAL(INTERNAL_LIBUPNP, test x"$with_external_libupnp" != xyes)
 
+AM_CONDITIONAL(INTERNAL_LIBUPNP, false)
 
 
 #
diff --git a/djmount/file_buffer.c b/djmount/file_buffer.c
index 80a9e34..53ed70e 100644
--- a/djmount/file_buffer.c
+++ b/djmount/file_buffer.c
@@ -212,7 +212,7 @@ FileBuffer_Read (FileBuffer* file, char* buffer,
 		 * to return the exact number of bytes requested.
 		 */
 		do {
-			unsigned int read_size = size - n;
+			size_t read_size = size - n;
 			if (n > 0) {
 				Log_Printf (LOG_DEBUG, 
 					    "UpnpReadHttpGet loop ! url '%s' "
diff --git a/djmount/upnp_util.h b/djmount/upnp_util.h
index 93b85eb..effdbe2 100644
--- a/djmount/upnp_util.h
+++ b/djmount/upnp_util.h
@@ -26,7 +26,8 @@
 #ifndef UPNP_UTIL_H_INCLUDED
 #define UPNP_UTIL_H_INCLUDED
 
-
+#include <string.h>
+#include <upnp/upnp.h>
 #include <upnp/upnptools.h>
 
 
diff --git a/gl/Makefile.in b/gl/Makefile.in
index f3bbf25..83ddb25 100644
--- a/gl/Makefile.in
+++ b/gl/Makefile.in
@@ -55,17 +55,13 @@ DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
 	$(srcdir)/Makefile.in error.c error.h exitfail.c exitfail.h \
 	hash.c hash.h xalloc.h xmalloc.c
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
-am__aclocal_m4_deps = $(top_srcdir)/libupnp/m4/acx_pthread.m4 \
-	$(top_srcdir)/libupnp/m4/ax_cflags_gcc_option.m4 \
-	$(top_srcdir)/libupnp/m4/ax_cflags_warn_all.m4 \
-	$(top_srcdir)/libupnp/m4/rt_bool_arg_enable.m4 \
+am__aclocal_m4_deps = \
 	$(top_srcdir)/gl/m4/error.m4 $(top_srcdir)/gl/m4/exitfail.m4 \
 	$(top_srcdir)/gl/m4/gnulib-comp.m4 $(top_srcdir)/gl/m4/hash.m4 \
 	$(top_srcdir)/gl/m4/minmax.m4 $(top_srcdir)/gl/m4/stdbool.m4 \
 	$(top_srcdir)/gl/m4/xalloc.m4 \
 	$(top_srcdir)/m4/rt_package_find.m4 \
 	$(top_srcdir)/m4/vl_lib_readline.m4 \
-	$(top_srcdir)/talloc/talloc/config.m4 \
 	$(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
